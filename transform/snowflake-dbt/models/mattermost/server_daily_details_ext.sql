{{config({
    "materialized": 'incremental',
    "schema": "mattermost"
  })
}}

WITH server_daily_details_ext AS (
    SELECT
        s.date
      , s.server_id
      , s.ip_address
      , s.location
      , s.version
      , s.context_library_version
      , s.edition
      , s.active_user_count
      , s.user_count
      , s.system_admins
      , s.operating_system
      , s.database_type
      , s.account_sfid
      , s.license_id1
      , s.license_id2
      , s.in_security
      , s.in_mm2_server
      , s.tracking_disabled
      , s.has_dupes
      , s.has_multi_ips
      , s.timestamp
      , sc.active_users
      , sc.active_users_daily
      , sc.active_users_monthly
      , sc.bot_accounts
      , sc.bot_posts_previous_day
      , sc.direct_message_channels
      , sc.incoming_webhooks
      , sc.outgoing_webhooks
      , sc.posts
      , sc.posts_previous_day
      , sc.private_channels
      , sc.private_channels_deleted
      , sc.public_channels
      , sc.public_channels_deleted
      , sc.registered_deactivated_users
      , sc.registered_inactive_users
      , sc.registered_users
      , sc.slash_commands
      , sc.teams
      , sc.used_apiv3
      , sc.isdefault_max_users_for_statistics
      , sc.allow_banner_dismissal
      , sc.enable_banner
      , sc.isdefault_banner_color
      , sc.isdefault_banner_text_color
      , sc.allow_edit_post_client
      , sc.android_latest_version
      , sc.android_min_version
      , sc.desktop_latest_version
      , sc.desktop_min_version
      , sc.enable_apiv3_client
      , sc.enable_channel_viewed_messages_client
      , sc.enable_commands_client
      , sc.enable_custom_emoji_client
      , sc.enable_developer_client
      , sc.enable_emoji_picker_client
      , sc.enable_incoming_webhooks_client
      , sc.enable_insecure_outgoing_connections_client
      , sc.enable_multifactor_authentication_client
      , sc.enable_oauth_service_provider_client
      , sc.enable_only_admin_integrations_client
      , sc.ios_latest_version
      , sc.ios_min_version
      , sc.advertise_address
      , sc.bind_address
      , sc.enable_cluster
      , sc.network_interface
      , sc.read_only_config
      , sc.use_experimental_gossip
      , sc.use_ip_address
      , sc.enable_compliance
      , sc.enable_compliance_daily
      , sc.message_retention_days
      , sc.file_retention_days
      , sc.enable_message_deletion
      , sc.enable_file_deletion
      , sc.experimental_timezone
      , sc.isdefault_custom_url_schemes
      , sc.enable_autocomplete
      , sc.enable_indexing
      , sc.enable_searching
      , sc.isdefault_connection_url
      , sc.isdefault_index_prefix
      , sc.isdefault_password
      , sc.isdefault_username
      , sc.live_indexing_batch_size
      , sc.skip_tls_verification
      , sc.sniff
      , sc.trace_elasticsearch
      , sc.connection_security_email
      , sc.email_batching_buffer_size
      , sc.email_notification_contents_type
      , sc.enable_email_batching
      , sc.enable_preview_mode_banner
      , sc.enable_sign_in_with_email
      , sc.enable_sign_in_with_username
      , sc.enable_sign_up_with_email
      , sc.enable_smtp_auth
      , sc.isdefault_feedback_email
      , sc.isdefault_feedback_name
      , sc.isdefault_feedback_organization
      , sc.isdefault_login_button_border_color_email
      , sc.isdefault_login_button_color_email
      , sc.isdefault_login_button_text_color_email
      , sc.isdefault_reply_to_address
      , sc.push_notification_contents
      , sc.require_email_verification
      , sc.send_email_notifications
      , sc.send_push_notifications
      , sc.skip_server_certificate_verification
      , sc.use_channel_in_email_notifications
      , sc.client_side_cert_enable
      , sc.enable_click_to_reply
      , sc.enable_post_metadata
      , sc.isdefault_client_side_cert_check
      , sc.restrict_system_admin
      , sc.use_new_saml_library
      , sc.enable_experimental_extensions
      , sc.amazon_s3_signv2
      , sc.amazon_s3_sse
      , sc.amazon_s3_ssl
      , sc.amazon_s3_trace
      , sc.driver_name_file
      , sc.enable_file_attachments
      , sc.enable_mobile_download
      , sc.enable_mobile_upload
      , sc.enable_public_links
      , sc.isabsolute_directory
      , sc.isdefault_directory
      , sc.max_file_size
      , sc.preview_height
      , sc.preview_width
      , sc.profile_height
      , sc.profile_width
      , sc.thumbnail_height
      , sc.thumbnail_width
      , sc.allow_email_accounts
      , sc.enable_guest_accounts
      , sc.enforce_multifactor_authentication_guest
      , sc.isdefault_restrict_creation_to_domains
      , sc.enable_image_proxy
      , sc.image_proxy_type
      , sc.isdefault_remote_image_proxy_options
      , sc.isdefault_remote_image_proxy_url
      , sc.connection_security_ldap
      , sc.enable_ldap
      , sc.enable_admin_filter
      , sc.enable_sync
      , sc.isdefault_email_attribute_ldap
      , sc.isdefault_first_name_attribute_ldap
      , sc.isdefault_group_display_name_attribute
      , sc.isdefault_group_id_attribute
      , sc.isdefault_id_attribute_ldap
      , sc.isdefault_last_name_attribute_ldap
      , sc.isdefault_login_button_border_color_ldap
      , sc.isdefault_login_button_color_ldap
      , sc.isdefault_login_button_text_color_ldap
      , sc.isdefault_login_field_name
      , sc.isdefault_login_id_attribute
      , sc.isdefault_nickname_attribute_ldap
      , sc.isdefault_position_attribute_ldap
      , sc.isdefault_username_attribute_ldap
      , sc.isempty_admin_filter
      , sc.isempty_group_filter
      , sc.isempty_guest_filter
      , sc.max_page_size
      , sc.query_timeout_ldap
      , sc.segment_dedupe_id_ldap
      , sc.skip_certificate_verification
      , sc.sync_interval_minutes
      , sc.license_id
      , sc._start
      , sc.edition AS license_edition
      , sc.expire
      , sc.feature_cluster
      , sc.feature_compliance
      , sc.feature_custom_brand
      , sc.feature_custom_permissions_schemes
      , sc.feature_data_retention
      , sc.feature_elastic_search
      , sc.feature_email_notification_contents
      , sc.feature_future
      , sc.feature_google
      , sc.feature_guest_accounts
      , sc.feature_guest_accounts_permissions
      , sc.feature_id_loaded
      , sc.feature_ldap
      , sc.feature_ldap_groups
      , sc.feature_lock_teammate_name_display
      , sc.feature_message_export
      , sc.feature_metrics
      , sc.feature_mfa
      , sc.feature_mhpns
      , sc.feature_office365
      , sc.feature_password
      , sc.feature_saml
      , sc.issued
      , sc.users
      , sc.available_locales
      , sc.default_client_locale
      , sc.default_server_locale
      , sc.console_json_log
      , sc.console_level_log
      , sc.enable_console_log
      , sc.enable_file_log
      , sc.enable_webhook_debugging
      , sc.file_json_log
      , sc.file_level_log
      , sc.isdefault_file_format
      , sc.isdefault_file_location_log
      , sc.batch_size
      , sc.daily_run_time
      , sc.enable_message_export
      , sc.export_format
      , sc.global_relay_customer_type
      , sc.is_default_global_relay_email_address
      , sc.is_default_global_relay_smtp_password
      , sc.is_default_global_relay_smtp_username
      , sc.block_profile_rate
      , sc.enable_metrics
      , sc.isdefault_android_app_download_link
      , sc.isdefault_app_download_link
      , sc.isdefault_iosapp_download_link
      , sc.console_json_notifications
      , sc.console_level_notifications
      , sc.enable_console_notifications
      , sc.enable_file_notifications
      , sc.file_json_notifications
      , sc.file_level_notifications
      , sc.isdefault_file_location_notifications
      , sc.enable_office365_oauth
      , sc.enable_google_oauth
      , sc.enable_gitlab_oauth
      , sc.enable_lowercase
      , sc.enable_uppercase
      , sc.enable_symbol
      , sc.enable_number
      , sc.password_minimum_length
      , sc.phase_1_migration_complete
      , sc.phase_2_migration_complete
      , sc.channel_admin_permissions
      , sc.channel_guest_permissions
      , sc.channel_user_permissions
      , sc.system_admin_permissions
      , sc.system_user_permissions
      , sc.team_admin_permissions
      , sc.team_guest_permissions
      , sc.team_user_permissions
      , sc.allow_insecure_download_url
      , sc.automatic_prepackaged_plugins
      , sc.enable_plugins
      , sc.enable_antivirus
      , sc.enable_autolink
      , sc.enable_aws_sns
      , sc.enable_custom_user_attributes
      , sc.enable_github
      , sc.enable_gitlab
      , sc.enable_health_check
      , sc.enable_jenkins
      , sc.enable_jira
      , sc.enable_marketplace
      , sc.enable_nps
      , sc.enable_nps_survey
      , sc.enable_remote_marketplace
      , sc.enable_uploads
      , sc.enable_webex
      , sc.enable_welcome_bot
      , sc.enable_zoom
      , sc.is_default_marketplace_url
      , sc.require_plugin_signature
      , sc.signature_public_key_files
      , sc.version_antivirus
      , sc.version_autolink
      , sc.version_aws_sns
      , sc.version_custom_user_attributes
      , sc.version_github
      , sc.version_gitlab
      , sc.version_jenkins
      , sc.version_jira
      , sc.version_nps
      , sc.version_webex
      , sc.version_welcome_bot
      , sc.version_zoom
      , sc.active_backend_plugins
      , sc.active_plugins
      , sc.active_webapp_plugins
      , sc.disabled_backend_plugins
      , sc.disabled_plugins
      , sc.disabled_webapp_plugins
      , sc.enabled_backend_plugins
      , sc.enabled_plugins
      , sc.enabled_webapp_plugins
      , sc.inactive_backend_plugins
      , sc.inactive_plugins
      , sc.inactive_webapp_plugins
      , sc.plugins_with_broken_manifests
      , sc.plugins_with_settings
      , sc.show_email_address
      , sc.show_full_name
      , sc.enable_rate_limiter
      , sc.isdefault_vary_by_header
      , sc.max_burst
      , sc.memory_store_size
      , sc.per_sec
      , sc.vary_by_remote_address
      , sc.vary_by_user
      , sc.enable_saml
      , sc.enable_admin_attribute
      , sc.enable_sync_with_ldap
      , sc.enable_sync_with_ldap_include_auth
      , sc.encrypt_saml
      , sc.isdefault_admin_attribute
      , sc.isdefault_canonical_algorithm
      , sc.isdefault_email_attribute_saml
      , sc.isdefault_first_name_attribute_saml
      , sc.isdefault_guest_attribute
      , sc.isdefault_id_attribute_saml
      , sc.isdefault_last_name_attribute_saml
      , sc.isdefault_locale_attribute
      , sc.isdefault_login_button_border_color_saml
      , sc.isdefault_login_button_color_saml
      , sc.isdefault_login_button_text
      , sc.isdefault_login_button_text_color_saml
      , sc.isdefault_nickname_attribute_saml
      , sc.isdefault_position_attribute_saml
      , sc.isdefault_scoping_idp_name
      , sc.isdefault_scoping_idp_provider_id
      , sc.isdefault_signature_algorithm
      , sc.isdefault_username_attribute_saml
      , sc.sign_request
      , sc.verify_saml
      , sc.allow_cookies_for_subdomains
      , sc.allow_edit_post_service
      , sc.close_unused_direct_messages
      , sc.connection_security_service
      , sc.cors_allow_credentials
      , sc.cors_debug
      , sc.custom_service_terms_enabled_service
      , sc.disable_bots_when_owner_is_deactivated
      , sc.disable_legacy_mfa
      , sc.enable_apiv3_service
      , sc.enable_api_team_deletion
      , sc.enable_bot_account_creation
      , sc.enable_channel_viewed_messages_service
      , sc.enable_commands_service
      , sc.enable_custom_emoji_service
      , sc.enable_developer_service
      , sc.enable_email_invitations
      , sc.enable_emoji_picker_service
      , sc.enable_gif_picker
      , sc.enable_incoming_webhooks_service
      , sc.enable_insecure_outgoing_connections_service
      , sc.enable_latex
      , sc.enable_multifactor_authentication_service
      , sc.enable_oauth_service_provider_service
      , sc.enable_only_admin_integrations_service
      , sc.enable_outgoing_webhooks
      , sc.enable_post_icon_override
      , sc.enable_post_search
      , sc.enable_post_username_override
      , sc.enable_preview_features
      , sc.enable_security_fix_alert
      , sc.enable_svgs
      , sc.enable_testing
      , sc.enable_tutorial
      , sc.enable_user_access_tokens
      , sc.enable_user_statuses
      , sc.enable_user_typing_messages
      , sc.enforce_multifactor_authentication_service
      , sc.experimental_channel_organization
      , sc.experimental_enable_authentication_transfer
      , sc.experimental_enable_default_channel_leave_join_messages
      , sc.experimental_enable_hardened_mode
      , sc.experimental_group_unread_channels
      , sc.experimental_ldap_group_sync
      , sc.experimental_limit_client_config
      , sc.experimental_strict_csrf_enforcement
      , sc.forward_80_to_443
      , sc.gfycat_api_key
      , sc.gfycat_api_secret
      , sc.isdefault_allowed_untrusted_internal_connections
      , sc.isdefault_allowed_untrusted_inteznal_connections
      , sc.isdefault_allow_cors_from
      , sc.isdefault_cors_exposed_headers
      , sc.isdefault_google_developer_key
      , sc.isdefault_image_proxy_options
      , sc.isdefault_image_proxy_type
      , sc.isdefault_image_proxy_url
      , sc.isdefault_read_timeout
      , sc.isdefault_site_url
      , sc.isdefault_tls_cert_file
      , sc.isdefault_tls_key_file
      , sc.isdefault_write_timeout
      , sc.maximum_login_attempts
      , sc.minimum_hashtag_length
      , sc.post_edit_time_limit
      , sc.restrict_custom_emoji_creation
      , sc.restrict_post_delete
      , sc.session_cache_in_minutes
      , sc.session_idle_timeout_in_minutes
      , sc.session_length_mobile_in_days
      , sc.session_length_sso_in_days
      , sc.session_length_web_in_days
      , sc.tls_strict_transport
      , sc.uses_letsencrypt
      , sc.websocket_url
      , sc.web_server_mode
      , sc.driver_name_sql
      , sc.enable_public_channels_materialization
      , sc.max_idle_conns
      , sc.max_open_conns
      , sc.query_timeout_sql
      , sc.trace_sql
      , sc.custom_service_terms_enabled_support
      , sc.custom_terms_of_service_enabled
      , sc.custom_terms_of_service_re_acceptance_period
      , sc.isdefault_about_link
      , sc.isdefault_help_link
      , sc.isdefault_privacy_policy_link
      , sc.isdefault_report_a_problem_link
      , sc.isdefault_support_email
      , sc.isdefault_terms_of_service_link
      , sc.segment_dedupe_id_support
      , sc.enable_confirm_notifications_to_channel
      , sc.enable_custom_brand
      , sc.enable_open_server
      , sc.enable_team_creation
      , sc.enable_user_creation
      , sc.enable_user_deactivation
      , sc.enable_x_to_leave_channels_from_lhs
      , sc.experimental_default_channels
      , sc.experimental_enable_automatic_replies
      , sc.experimental_primary_team
      , sc.experimental_town_square_is_hidden_in_lhs
      , sc.experimental_town_square_is_read_only
      , sc.experimental_view_archived_channels
      , sc.isdefault_custom_brand_text
      , sc.isdefault_custom_description_text
      , sc.isdefault_site_name
      , sc.isdefault_user_status_away_timeout
      , sc.lock_teammate_name_display
      , sc.max_channels_per_team
      , sc.max_notifications_per_channel
      , sc.max_users_per_team
      , sc.restrict_direct_message
      , sc.restrict_private_channel_creation
      , sc.restrict_private_channel_deletion
      , sc.restrict_private_channel_management
      , sc.restrict_private_channel_manage_members
      , sc.restrict_public_channel_creation
      , sc.restrict_public_channel_deletion
      , sc.restrict_public_channel_management
      , sc.restrict_team_invite
      , sc.teammate_name_display
      , sc.view_archived_channels
      , sc.allowed_themes
      , sc.allow_custom_themes
      , sc.enable_theme_selection
      , sc.isdefault_default_theme
      , sc.isdefault_supported_timezones_path
      , sc.enable
      , sc.isdefault_stun_uri
      , sc.isdefault_turn_uri
      , sc.id
    FROM {{ ref('server_daily_details') }}         s
         LEFT JOIN {{ ref('server_config_details') }} sc
                   ON s.server_id = sc.server_id
                       AND s.date = sc.date
    {% if is_incremental() %}
    
    WHERE s.date > (SELECT MAX(date) FROM {{this}})

    {% endif %}
    GROUP BY 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25,
             26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50,
             51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75,
             76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 91, 92, 93, 94, 95, 96, 97, 98, 99, 100,
             101, 102, 103, 104, 105, 106, 107, 108, 109, 110, 111, 112, 113, 114, 115, 116, 117, 118, 119, 120,
             121, 122, 123, 124, 125, 126, 127, 128, 129, 130, 131, 132, 133, 134, 135, 136, 137, 138, 139, 140,
             141, 142, 143, 144, 145, 146, 147, 148, 149, 150, 151, 152, 153, 154, 155, 156, 157, 158, 159, 160,
             161, 162, 163, 164, 165, 166, 167, 168, 169, 170, 171, 172, 173, 174, 175, 176, 177, 178, 179, 180,
             181, 182, 183, 184, 185, 186, 187, 188, 189, 190, 191, 192, 193, 194, 195, 196, 197, 198, 199, 200,
             201, 202, 203, 204, 205, 206, 207, 208, 209, 210, 211, 212, 213, 214, 215, 216, 217, 218, 219, 220,
             221, 222, 223, 224, 225, 226, 227, 228, 229, 230, 231, 232, 233, 234, 235, 236, 237, 238, 239, 240,
             241, 242, 243, 244, 245, 246, 247, 248, 249, 250, 251, 252, 253, 254, 255, 256, 257, 258, 259, 260,
             261, 262, 263, 264, 265, 266, 267, 268, 269, 270, 271, 272, 273, 274, 275, 276, 277, 278, 279, 280,
             281, 282, 283, 284, 285, 286, 287, 288, 289, 290, 291, 292, 293, 294, 295, 296, 297, 298, 299, 300,
             301, 302, 303, 304, 305, 306, 307, 308, 309, 310, 311, 312, 313, 314, 315, 316, 317, 318, 319, 320,
             321, 322, 323, 324, 325, 326, 327, 328, 329, 330, 331, 332, 333, 334, 335, 336, 337, 338, 339, 340,
             341, 342, 343, 344, 345, 346, 347, 348, 349, 350, 351, 352, 353, 354, 355, 356, 357, 358, 359, 360,
             361, 362, 363, 364, 365, 366, 367, 368, 369, 370, 371, 372, 373, 374, 375, 376, 377, 378, 379, 380,
             381, 382, 383, 384, 385, 386, 387, 388, 389, 390, 391, 392, 393, 394, 395, 396, 397, 398, 399, 400,
             401, 402, 403, 404, 405, 406, 407, 408, 409, 410, 411, 412, 413, 414, 415, 416, 417, 418, 419, 420,
             421, 422, 423, 424, 425, 426, 427, 428, 429, 430, 431, 432, 433, 434, 435, 436, 437, 438, 439, 440,
             441, 442, 443, 444, 445, 446, 447, 448, 449, 450, 451, 452, 453, 454, 455, 456, 457, 458, 459, 460,
             461, 462, 463, 464, 465
)

SELECT *
FROM server_daily_details_ext