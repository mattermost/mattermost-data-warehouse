version: 2

models:
  - name: fct_active_users
    desription: |
      This model contains the list of in app product trial requests, as well as some extra metadata

    columns:
      - name: trial_request_id
        description: The unique identifier for the trial request
        tests:
          - unique
          - not_null
      - name: trial_email
        description: The trial's email. Contact email is preferred if present, otherwise the user's email is used.
      - name: server_id
        description: The unique identifier for the server.
      - name: email_domain
        description: The domain of the trial email.
      - name: email
        description: TODO - define difference between email and contact email.
      - name: contact_email
        description: TODO - define difference between email and contact email.
      - name: name
        description: The name of the trial user.
      - name: company_name
        description: The name of the company, or `Unknown` if not provided.
      - name: company_size_bucket
        description: The size of the company, bucketed into ranges.
        tests:
          - accepted_values:
              values: ['ONE_TO_50', 'FIFTY_TO_100', 'ONE_HUNDRED_TO_500', 'FIVE_HUNDRED_TO_1000', 'ONE_THOUSAND_TO_2500', 'TWO_THOUSAND_FIVE_HUNDRED_AND_UP']
              config:
                where: "company_size_bucket is not null"
      - name: site_name
        description: The name of the Mattermost site.
      - name: site_url
        description: The URL of the Mattermost site.
      - name: request_source
        description: |
          The source of the trial request. Either website or in-product. Website requests are used for 
          air-gapped environments.
        tests:
          - not_null
          - accepted_values:
              values: [ 'Website', 'In-Product' ]
      - name: start_at
        description: The timestamp when the trial started.
        tests:
          - not_null
      - name: end_at
        description: The timestamp when the trial ends/ended.
        tests:
          - not_null
      - name: country_name
        description: The name of the country, or `Unknown` if not provided.
      - name: num_users
        description: The number of the users in the trial.
      - name: is_first_trial
        description: |
          Whether this is the first trial for the user. This is determined by the start date of the trial request,
          grouped by the trial's email.
      - name: is_last_trial
        description: |
          Whether this is the last trial for the user. This is determined by the start date of the trial request,
          grouped by the trial's email.
      - name: total_trial_requests
        description: The total number of trial requests from the given email.
      - name: first_trial_start_at
        description: The timestamp of the first trial request from the given email.
      - name: last_trial_start_at
        description: The timestamp of the last trial request from the given email.
      - name: company_type
        description: The company type for the trial requests. Uses Salesforce lead information to get these data.
      - name: number_of_company_types
        description: The total number of distinct company types for all leads matching the current trial request's email.
        tests:
          - dbt_utils.accepted_range:
              min_value: 0
              max_value: 1
              inclusive: true