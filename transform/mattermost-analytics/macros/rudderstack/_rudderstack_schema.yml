version: 2

macros:

  - name: get_rudderstack_columns
    description: |
      Returns a list of columns that are default to all rudderstack tables.

  - name: join_tracks_event_tables
    description: |
      A macro that joins event tables to a single table, keeping the extra columns. 
      
      Rudderstack stores one row in two tables for each event. 
      - `tracks`, which holds generic information about the event, and
      - `event_name`, which holds the extra user defined properties. 
      
      This macro joins all tables except the default tables defined in
      [warehouse schema](https://www.rudderstack.com/docs/destinations/warehouse-destinations/warehouse-schema). It also
      allows for filtering which columns to keep. This can be useful in scenarios where events share properties (i.e. 
      indicating event hierarchy, A/B test allocations etc).

    arguments:
      - name: schema
        type: string
        description: The schema that contains the event tables.
      - name: columns
        type: list
        description: The list of columns to keep.

  - name: get_event_relations
    description: |
      Returns a list of tables from the given schema that might be Rudderstack events. Offers functionality for 
      filtering out tables with too few rows.
    arguments:
      - name: schema
        type: string
        description: The schema that contains the event tables.
      - name: min_rows
        type: integer
        description: Keep only tables with rows greater or equal to this value (default 100).
      - name: database
        type: string
        description: The database that contains the schema provided as the first argument.

  - name: union_relations
    description: |
      This macro combines via union all an array of Relations, even when columns have 
      differing orders in each Relation, and/or some columns are missing from some relations. 
      Any columns exclusive to a subset of these relations will be filled with null where not present. 
      A new column (_dbt_source_relation) is also added to indicate the source for each record.
    arguments:
      - name: relations (required)
        description: An array of Relations.
      - name: exclude (optional)
        description: A list of column names that should be excluded from the final query.
      - name: include (optional)
        description:  A list of column names that should be included in the final query. Note the include and exclude arguments are mutually exclusive.
      - name: column_override (optional)
        description: A dictionary of explicit column type overrides.
      - name: source_column_name (optional, default="_dbt_source_relation")
        description: The name of the column that records the source of this row. Pass None to omit this column from the results.
      - name: where (optional)
        description: Filter conditions to include in the where clause.
